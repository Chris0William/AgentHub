# 前端问题修复方案

## 问题清单

### 1. 移动端流式传输显示问题
**问题描述**：流式消息在移动端显示有格式问题
**根本原因**：
- 流式消息容器缺少移动端优化的样式
- prose类在移动端可能导致文本溢出
- 需要添加合适的断行和滚动处理

**修复方案**：
- 为流式消息容器添加 `break-words` 和 `overflow-wrap: break-word`
- 确保 prose 类在移动端有正确的 max-width
- 添加移动端专属的字体大小调整

### 2. 编辑回答功能问题
**问题描述**：编辑消息后重新发送有问题
**根本原因**：
- `saveAndResend` 函数可能在删除消息后逻辑有问题
- 需要验证消息删除和重新发送的流程

**修复方案**：
- 检查并优化 `saveAndResend` 函数逻辑
- 确保消息编辑后能正确触发重新生成

### 3. 多轮对话越来越笨
**问题描述**：对话进行多轮后，AI回答质量下降
**根本原因**：
- 当前只保留最近3轮对话（6条消息），上下文丢失太快
- 摘要生成可能不够准确，导致长期记忆质量差
- 需要优化上下文窗口管理策略

**修复方案**：
- 增加保留的对话轮数：从3轮增加到5轮（10条消息）
- 优化摘要生成策略：更侧重用户的核心需求和关键事实
- 调整ChatHistory压缩阈值：从20轮增加到30轮

### 4. AI幻觉和数据来源问题
**问题描述**：AI有时会编造信息，缺乏权威性和数据来源
**根本原因**：
- 系统提示词虽然强调搜索，但AI仍可能不使用工具
- 缺少"引用来源"的明确要求
- 温度设置（0.3）可能还不够低

**修复方案**：
- 降低Temperature从0.3到0.1，减少创造性
- 增强系统提示词：
  - 明确要求"必须注明信息来源"
  - 添加"不确定就说不确定，不要猜测"的指令
  - 强化工具使用的优先级
- 在回答中要求AI使用"根据XX工具查询"的格式
