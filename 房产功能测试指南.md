# 房产功能测试指南

## ✅ 已完成的工作

1. ✅ 创建房产服务接口和实现类
2. ✅ 创建房产数据插件（RealEstatePlugin）
3. ✅ 注册服务到DI容器
4. ✅ 集成到Semantic Kernel
5. ✅ 编译通过（0个错误）

## 🚀 如何测试

### 1. 重新发布到生产环境

```bash
# 发布新版本
cd E:\WorkSpace\WorkSpace-Net\AgentHub
dotnet publish src\AgentHub.API -c Release -o "E:\IIS Programs\AgentHub"
```

### 2. 重启生产环境服务

```bash
# 停止当前服务（Ctrl+C）
# 然后重新启动
cd "E:\IIS Programs\AgentHub"
dotnet AgentHub.API.dll --urls=http://0.0.0.0:5570
```

### 3. 测试用例

打开前端（http://localhost:5567），创建或打开玄学Agent会话，输入以下测试问题：

#### 测试用例1：搜索楼盘

**输入**：
```
东莞有哪些在售楼盘？
```

**预期**：
- AI会调用 `SearchProperty` 工具
- 返回东莞楼盘列表，包含链接和简要描述

---

#### 测试用例2：价格筛选

**输入**：
```
深圳200-300万的楼盘有哪些？
```

**预期**：
- AI会调用 `SearchProperty`，传入 minPrice=200, maxPrice=300
- 返回符合价格区间的楼盘

---

#### 测试用例3：查询房价走势

**输入**：
```
东莞房价怎么样？2025年的趋势是什么？
```

**预期**：
- AI会调用 `GetPriceTrend` 工具
- 返回东莞房价走势分析

---

#### 测试用例4：查询楼盘详情

**输入**：
```
东莞海逸豪庭楼盘详情，包括均价、户型、地址
```

**预期**：
- AI会调用 `GetPropertyDetail` 工具
- 返回海逸豪庭的详细信息

---

#### 测试用例5：楼盘推荐

**输入**：
```
我预算200万，想在东莞买房，帮我推荐一些楼盘
```

**预期**：
- AI会调用 `RecommendProperty` 工具
- 返回符合预算的楼盘推荐

---

#### 测试用例6：结合玄学推荐（核心场景）

**输入**：
```
我是1990年8月15日生，预算250万，想在东莞买房，有什么风水方面的建议吗？
```

**预期**：
- AI会先调用玄学工具（生肖、五行等）
- 然后调用 `RecommendProperty` 推荐楼盘
- 结合风水给出购房建议（如楼层、朝向等）

---

## 📊 查看工具调用日志

在服务运行的控制台中，会看到类似的日志：

```
【工具调用】SearchProperty: city=东莞, keyword=, minPrice=, maxPrice=
搜索楼盘: 东莞 在售楼盘 2025
SearXNG搜索: 东莞 在售楼盘 2025
```

## 🐛 常见问题排查

### 问题1：AI没有调用房产工具

**原因**：
- 提示词不够明确
- AI没有理解需要使用工具

**解决**：
- 明确提问，如"搜索东莞楼盘"
- 检查日志，查看是否有工具调用记录

---

### 问题2：搜索结果为空

**原因**：
- SearXNG服务未运行
- 搜索关键词过于具体

**解决**：
```bash
# 检查SearXNG容器
docker ps | grep searxng

# 重启容器（如果需要）
docker restart searxng-enhanced
```

---

### 问题3：工具调用历史不显示

**原因**：
- 前端需要刷新
- 缓存问题

**解决**：
- 强制刷新浏览器（Ctrl+Shift+R）
- 检查是否已复制最新前端文件

---

## 📝 日志示例

成功调用房产工具时的日志：

```log
2025-10-26 18:30:15 [Information] 【工具调用】SearchProperty: city=东莞, keyword=, minPrice=, maxPrice=
2025-10-26 18:30:15 [Information] 搜索楼盘: 东莞 在售楼盘 2025
2025-10-26 18:30:15 [Information] SearXNG搜索: 东莞 在售楼盘 2025
2025-10-26 18:30:16 [Information] SearXNG返回结果数: 5, 总结果数: 127
2025-10-26 18:30:16 [Information] 搜索完成，已使用 1/3 次搜索机会
```

---

## ✨ 功能亮点

1. **智能缓存**
   - 6小时缓存，避免重复搜索
   - 提高响应速度

2. **工具调用历史**
   - 完成后可查看AI的调用过程
   - 透明的决策过程

3. **搜索限制**
   - 每次对话最多3次搜索
   - 防止滥用

4. **玄学结合**
   - 根据用户八字推荐楼盘
   - 风水建议

---

## 🎯 后续优化方向

1. **接入官方API**
   - 贝壳开放平台
   - 云房数据

2. **功能增强**
   - 楼盘对比
   - 价格预测
   - VR看房链接

3. **风水分析**
   - 楼层选择（结合生辰）
   - 朝向建议
   - 周边环境分析

---

## 📞 需要帮助？

如遇到问题，请检查：
1. SearXNG容器是否运行
2. 后端日志是否有错误
3. 前端是否刷新最新版本

---

**祝测试顺利！** 🎉
